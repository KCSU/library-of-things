{% extends "sidebar.html" %}
{% block content %}

<div class="fixed top-0 left-0 w-full h-full z-[99] bg-black/30 backdrop-blur-sm cursor-pointer transition-opacity duration-300 overlay hidden opacity-0" id="confirm-overlay" onclick="dismissOverlay()">
  <div class="flex items-center justify-center h-full w-full">
    <div class="card w-2/5 mb-5 border-[oklch(1 0 0/25%)] border-[1px] cursor-default max-h-5/6 overflow-scroll" onclick="event.stopPropagation()">
      <header class="return-item-section">
        <h2>Return Item</h2>
        <p>Return selected item to the library and allow it to be borrowed.</p>
      </header>

      <section class="text-sm return-item-section">
        <button class="btn" onclick="returnItem()">Return Item</button>
      </section>

      <hr class="return-item-section"/>

      <header class="edit-item-section">
        <h2>Edit Item</h2>
        <p>Edit the details of the selected item.</p>
      </header>

      <header class="add-item-section">
        <h2>Add New Item</h2>
        <p>Enter the details of the new item.</p>
      </header>

      <section class="text-sm">
        <form class="form grid gap-6" id="edit-form">
          <div class="grid gap-2">
            <label for="item-id">Item ID</label>
            <input type="text" id="item-id" placeholder="42" value="">
          </div>

          <div class="grid gap-2">
            <label for="item-name">Item Name</label>
            <input type="text" id="item-name" placeholder="" value="">
          </div>

          <div class="grid gap-2">
            <label for="item-description">Item Description</label>
            <textarea id="item-description" placeholder="" rows="3"></textarea>
          </div>

          <div class="grid gap-2" id="item-location-container">
            <label for="item-location">Item Location</label>
            <input type="text" id="item-location" placeholder="" value="">
          </div>

          <div class="grid gap-2">
            <label for="item-image">Image URL</label>
            <input type="text" id="item-image" placeholder="" value="">
          </div>

          <div class="grid gap-2">
            <label for="item-category">Item Category</label>
            <select id="item-category">
              <option value="clothing">Clothing</option>
              <option value="kitchenware">Kitchenware</option>
              <option value="sports">Sports</option>
              <option value="electronics">Electronics</option>
              <option value="others">Others</option>
            </select>
          </div>

          <div class="grid gap-2">
            <label for="item-loan-duration">Loan Duration</label>
            <select id="item-loan-duration">
              <option value="short">Short (1 week)</option>
              <option value="long">Long (End of academic year)</option>
              <option value="permanent">Permanent</option>
            </select>
          </div>

          <div class="flex justify-between">
            <button type="button" onclick="dismissOverlay()" class="btn btn-secondary">Cancel</button>
            <button type="submit" class="btn">Confirm</button>
          </div>
        </form>
      </section>

      <hr class="loan-item-section"/>

      <header class="loan-item-section">
        <h2>Loan Item</h2>
        <p>Manually loan the selected item to a student. This would normally be done automatically after the item is marked as delivered.</p>
      </header>

      <section class="text-sm loan-item-section">
        <form class="form grid gap-2" id="loan-form">
          <div class="flex gap-4 ">
            <input type="email" id="loan-email" aria-invalid="true" placeholder="crsid@cam.ac.uk" class="flex-1">
            <button type="submit" class="btn">Loan Item</button>
          </div>
          <span class="text-xs" style="color: oklch(.704 .191 22.216)">This CRSid is not registered as a user in the directory; did you enter the correct email?</span>
        </form>
      </section>

      <hr class="delete-item-section" />

      <header class="delete-item-section">
        <h2>Delete Item</h2>
        <p>Remove the selected item from the inventory. This action is irreversible!</p>
      </header>

      <section class="text-sm delete-item-section">
        <button class="btn btn-destructive" onclick="deleteItem()">Delete Item</button>
      </section>
    </div>
  </div>
</div>

<div class="container mx-auto px-16 py-4">
  <table class="table w-full">
    <thead>
      <tr>
        <th class="w-8">#</th>
        <th class="w-32">Name</th>
        <th class="w-10">Image</th>
        <th class="w-24">Location</th>
        <th class="w-24">Loan Duration</th>
        <th class="w-24">Borrowed By</th>
        <th class="w-24">Due Date</th>
        <th class="w-20">Actions</th>
      </tr>
    </thead>
    {% for item in items %}
    <tbody>
      <tr>
        <td class="font-medium">{{ item.display_id }}</td>
        <td class="text-ellipsis overflow-hidden">{{ item.title }}</td>
        <td><a class="hover:underline text-blue-500" target="_blank" href="{{ item.image_url }}">Link</a></td>
        <td class="text-ellipsis overflow-hidden">{% if 'location' in item %}{{ item.location }}{% else %}--{% endif %}</td>
        <td>{{ item.borrow_length | capitalize }}</td>
        <td>
          {% if 'borrowed_by' in item %}
          <a class="hover:underline text-blue-500" href="mailto:{{ item.borrowed_by }}@cam.ac.uk">{{ item.borrowed_by }}@cam.ac.uk</a>
          {% else %}
          --
          {% endif %}
        </td>
        <td>
          {% if 'borrowed_by' in item and item.due_date < datetime_now %}
          <div style="color: oklch(.704 .191 22.216)" data-tooltip="This item is overdue! Please contact the borrower.">
            <span class="inline-block icon !w-[1rem]" data-icon="warning"></span>
            {{ item.due_date.strftime("%d/%m/%Y %H:%M") }}
          </div>
          {% elif 'borrowed_by' in item %}
          {{ item.due_date.strftime("%d/%m/%Y %H:%M") }}
          {% else %}
          --
          {% endif %}
        </td>
        <td>
          <button onclick='showOverlay({{ item | tojson | safe }})' class="btn btn-secondary text-sm h-[2.25em] mr-1">Details</button>
        </td>
      </tr>
    </tbody>
    {% endfor %}
  </table>
  <button onclick="showOverlay({})" class="btn btn-secondary mt-2">Add New Item</button>
</div>

<script src="{{ url_for('static', filename='js/inventory.js') }}"></script>

{% endblock %}